# Техническое задание на разработку Telegram-бота для кофейни

## 1. Введение
Настоящее техническое задание описывает требования к разработке Telegram-бота для локальной кофейни.  
Цель разработки — автоматизация приёма заказов и стимулирование потока клиентов в непиковые часы.

## 2. Цели и задачи
**Цели:**
- Увеличить поток клиентов в непиковые часы (с 14:00 до 17:00 и с 20:00 до 22:00)
- Упростить процесс заказа кофе и сопутствующих товаров через Telegram
- Повысить удобство взаимодействия пользователей с кофейней
- Снизить нагрузку на персонал за счёт автоматизации приёма заказов

**Задачи:**
- Реализовать возможность выбора позиций из меню
- Обеспечить оплату заказа через QR-код
- Настроить систему уведомлений об успешной оплате
- Реализовать выбор формата получения заказа: самовывоз или доставка
- При доставке — обеспечить валидацию и сохранение адреса доставки
- Реализовать систему скидок и акций для стимулирования заказов в непиковое время

## 3. Требования к функционалу
- В боте должно быть интерактивное меню с позициями кофейни
- Пользователь может выбрать несколько товаров в один заказ
- Доступна оплата заказа по QR-коду через интегрированную платежную систему
- Пользователь получает уведомление об успешной оплате
- Пользователь выбирает способ получения заказа:
  - **Самовывоз** — бот отображает адрес кофейни и ориентировочное время готовности заказа. После оплаты пользователь получает номер заказа для предъявления на кассе.
  - **Доставка в офис** — с обязательным заполнением:
    - Адрес (улица, дом, офис/кабинет) с валидацией на минимальную длину и наличие номера дома
    - Этаж
    - Контактный телефон для уточнений с проверкой формата
    - Комментарий для курьера (необязательное поле)
- При выборе доставки система проверяет попадание адреса в радиус 3 км от кофейни
- Все введенные адреса доставки сохраняются в профиле пользователя (при согласии) для быстрого выбора при повторном заказе
- История заказов хранится в базе данных
- Система уведомлений для администратора о новых заказах

## 4. Требования к интерфейсу
- Интерфейс должен быть реализован в виде Telegram-меню и интерактивных кнопок
- Минимальное использование ручного ввода текста для удобства пользователей
- Поддержка русского языка
- Подтверждения и уведомления должны содержать эмодзи для повышения вовлечённости
- Четкая визуальная группировка элементов меню по категориям (кофе, чай, десерты и т.д.)
- Прогресс-бар этапов заказа (выбор → корзина → оплата → подтверждение)

## 5. Нефункциональные требования
- **Производительность:** 
  - Время отклика бота — не более 2 секунд (обоснование: соответствует рекомендациям Nielsen Norman Group для интерактивных систем, где задержка более 1 секунды прерывает поток мыслей пользователя)
  - Поддержка до 500 одновременных пользователей (обоснование: с запасом покрывает потенциальный всплеск активности и обеспечивает запас для роста локальной кофейни)
- **Масштабируемость:** Архитектура должна позволять увеличение количества пользователей на 50% без переписывания кода
- **Безопасность:** 
  - Защита персональных данных пользователей (телефон, адрес)
  - Шифрование платежной информации
- **Надежность:** Доступность 99% в рабочее время кофейни (с 8:00 до 23:00) (обоснование: 99% доступности означает не более ~1.5 часа простоя в неделю, что приемлемо для системы заказов с возможностью проведения техобслуживания)

## 6. Интеграции и окружение
- **Платёжная система:** Интеграция с API платежного провайдера (ЮKassa, CloudPayments) для генерации QR-кодов
- **База данных:** PostgreSQL для хранения заказов, пользователей и меню (обоснование: надежность, поддержка ACID-транзакций, критически важных для учета оплат, богатый набор типов данных для гибкого хранения)
- **Хостинг:** Облачный сервер (VPS/PaaS, например, Yandex Cloud, AWS Lightsail, Heroku) с поддержкой Node.js/Python (обоснование: гибкость масштабирования, отказоустойчивость, упрощенное развертывание и интеграция с облачными сервисами)
- **Telegram Bot API:** Для основного функционала бота

## 7. Ограничения и допущения
- Работа только в мессенджере Telegram
- Требуется стабильный доступ к интернету
- Оплата реализуется только через QR-код (без других способов оплаты)
- Доставка ограничена радиусом 3 км от кофейни
- Предполагается, что пользователи имеют базовые навыки использования Telegram: умение найти бота по имени, отправить команду /start, взаимодействовать с инлайн-кнопками и вводить текст. Не предполагается знание специальных команд бота кроме /start и /help.

## 8. Критерии приёмки
- Бот доступен по уникальному @username в Telegram
- Пользователь может выполнить полный цикл заказа от выбора товара до получения подтверждения
- Все варианты получения заказа работают корректно
- При доставке — бот требует обязательного заполнения всех полей адреса
- Система корректно генерирует QR-код для оплаты
- Тестовые сценарии выполняются успешно:
  - Заказ 1 позиции → успешная оплата → уведомление
  - Заказ нескольких позиций → оплата → уведомление
  - Заказ с доставкой → ввод полного адреса → оплата → уведомление
  - Проверка валидации обязательных полей при доставке
  - Сценарий "Отмена заказа": пользователь отменяет заказ до оплаты, корзина очищается
  - Сценарий "Повторный заказ": авторизованный пользователь может быстро повторить прошлый заказ
  - Сценарий "Валидация непиковой скидки": заказ в период 14:00-17:00 автоматически получает скидку
  - Сценарий "Ошибка оплаты": при неудачной оплате бот уведомляет пользователя и предлагает повторить или отменить

## 9. Глоссарий
- **Непиковые часы:** Периоды времени с 14:00 до 17:00 и с 20:00 до 22:00, определенные администрацией кофейни для применения специальных стимулирующих акций.
- **QR-код оплаты:** Графическое изображение, содержащее ссылку на платежную форму интегрированной системы (ЮKassa/CloudPayments), которое пользователь сканирует для перехода к оплате.
- **Вебхук (Webhook):** Механизм, с помощью которого внешняя система (платежный шлюз) отправляет в бот асинхронное уведомление о событии (успешная/неуспешная оплата).
- **Администратор бота:** Сотрудник кофейни, имеющий доступ к панели управления заказами и уведомлениям.

## 10. Приложения
**Будущие доработки:**
- Интеграция нейросети для общения с пользователем в развлекательных целях
- Система NFT-стикеров в Telegram для закрепления уникальных заказов за пользователями
- Программа лояльности с накопительными бонусами
- Push-уведомления о специальных предложениях в непиковые часы